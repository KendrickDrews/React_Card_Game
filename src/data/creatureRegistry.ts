import { CreatureSpecies, PlayerCreature } from '../types/creature';

let creatureCounter = 0;

export const creatureSpecies: Record<string, CreatureSpecies> = {
  cricket: {
    speciesId: 'cricket',
    name: 'Cricket',
    description: 'A nimble insect fighter with quick slashes and high initiative.',
    maxHp: 15,
    initiative: 7,
    spriteId: 'cricket',
    cards: ['cricket-slash', 'cricket-slash', 'cricket-chirp', 'cricket-leap', 'cricket-summon-wall', 'mana-crystal'],
    defaultAction: {
      id: 'cricket-auto-slash',
      name: 'Auto Slash',
      description: 'Cricket slashes the nearest enemy for 2 damage.',
      targetType: 'single_enemy',
      effect: { damage: 2 },
    },
    passive: null,
  },
  sun: {
    speciesId: 'sun',
    name: 'Sun Spirit',
    description: 'A radiant spirit that heals allies and burns foes with solar energy.',
    maxHp: 10,
    initiative: 4,
    spriteId: 'sun',
    cards: ['sun-flare', 'sun-heal', 'sun-radiance', 'guard'],
    defaultAction: {
      id: 'sun-auto-heal',
      name: 'Warm Glow',
      description: 'Sun Spirit heals the weakest ally for 2 HP.',
      targetType: 'single_ally',
      effect: { heal: 2 },
    },
    passive: null,
  },

  // ── New Starters ──

  beetle: {
    speciesId: 'beetle',
    name: 'Beetle',
    description: 'A sturdy tank that absorbs hits and retaliates with brute force.',
    maxHp: 20,
    initiative: 3,
    spriteId: 'beetle',
    cards: ['beetle-bash', 'beetle-shell', 'beetle-ram', 'guard'],
    defaultAction: {
      id: 'beetle-auto-block',
      name: 'Hunker',
      description: 'Beetle braces itself, gaining 3 block.',
      targetType: 'self',
      effect: { addBlock: 3 },
    },
    passive: {
      id: 'beetle-passive',
      name: 'Thick Carapace',
      description: 'When hit, gain 1 block.',
      trigger: 'on_take_damage',
      effect: { addBlock: 1 },
    },
  },
  moth: {
    speciesId: 'moth',
    name: 'Moth',
    description: 'A gentle support creature that spreads healing dust and gusting winds.',
    maxHp: 8,
    initiative: 6,
    spriteId: 'moth',
    cards: ['moth-scales', 'moth-gust', 'moth-veil', 'mana-crystal'],
    defaultAction: {
      id: 'moth-auto-heal',
      name: 'Dust Heal',
      description: 'Moth sprinkles healing scales on an ally for 2 HP.',
      targetType: 'single_ally',
      effect: { heal: 2 },
    },
    passive: {
      id: 'moth-passive',
      name: 'Healing Dust',
      description: 'When a card is played, heal 1 HP.',
      trigger: 'on_card_played',
      effect: { heal: 1 },
    },
  },
  firefly: {
    speciesId: 'firefly',
    name: 'Firefly',
    description: 'A fragile but explosive glass cannon that lights up the battlefield.',
    maxHp: 7,
    initiative: 9,
    spriteId: 'firefly',
    cards: ['firefly-spark', 'firefly-flash', 'firefly-bolt', 'mana-crystal'],
    defaultAction: {
      id: 'firefly-auto-zap',
      name: 'Zap',
      description: 'Firefly zaps an enemy for 3 damage.',
      targetType: 'single_enemy',
      effect: { damage: 3 },
    },
    passive: {
      id: 'firefly-passive',
      name: 'Charged Glow',
      description: 'When dealing damage, gain 1 mana.',
      trigger: 'on_deal_damage',
      effect: { addMana: 1 },
    },
  },
  toad: {
    speciesId: 'toad',
    name: 'Toad',
    description: 'A bulky amphibian that splashes damage across all enemies.',
    maxHp: 14,
    initiative: 4,
    spriteId: 'toad',
    cards: ['toad-spit', 'toad-splash', 'toad-croak', 'toad-tongue'],
    defaultAction: {
      id: 'toad-auto-spit',
      name: 'Spit',
      description: 'Toad spits acid at all enemies for 2 damage.',
      targetType: 'all_enemies',
      effect: { damage: 2 },
    },
    passive: {
      id: 'toad-passive',
      name: 'Regeneration',
      description: 'At the start of each turn, heal 1 HP.',
      trigger: 'on_turn_start',
      effect: { heal: 1 },
    },
  },

  // ── Recruitable ──

  mantis: {
    speciesId: 'mantis',
    name: 'Mantis',
    description: 'A lethal assassin that strikes hard and gains armor on kills.',
    maxHp: 11,
    initiative: 8,
    spriteId: 'mantis',
    cards: ['mantis-strike', 'mantis-slice', 'mantis-ambush', 'guard'],
    defaultAction: {
      id: 'mantis-auto-slash',
      name: 'Claw',
      description: 'Mantis claws an enemy for 4 damage.',
      targetType: 'single_enemy',
      effect: { damage: 4 },
    },
    passive: {
      id: 'mantis-passive',
      name: 'Predator Instinct',
      description: 'When an enemy dies, gain 3 block.',
      trigger: 'on_enemy_death',
      effect: { addBlock: 3 },
    },
  },
  spider: {
    speciesId: 'spider',
    name: 'Spider',
    description: 'A cunning controller that traps and repositions enemies.',
    maxHp: 10,
    initiative: 5,
    spriteId: 'spider',
    cards: ['spider-bite', 'spider-web', 'spider-trap', 'spider-spike-snare', 'mana-crystal'],
    defaultAction: {
      id: 'spider-auto-bite',
      name: 'Fang',
      description: 'Spider bites an enemy for 2 damage.',
      targetType: 'single_enemy',
      effect: { damage: 2 },
    },
    passive: {
      id: 'spider-passive',
      name: 'Silk Armor',
      description: 'At the end of each turn, gain 2 block.',
      trigger: 'on_turn_end',
      effect: { addBlock: 2 },
    },
  },
  dragonfly: {
    speciesId: 'dragonfly',
    name: 'Dragonfly',
    description: 'A blazing-fast striker that darts in and out of combat.',
    maxHp: 9,
    initiative: 10,
    spriteId: 'dragonfly',
    cards: ['dragonfly-dart', 'dragonfly-dive', 'dragonfly-swoop', 'dragonfly-zip'],
    defaultAction: {
      id: 'dragonfly-auto-dart',
      name: 'Quick Dart',
      description: 'Dragonfly darts at an enemy for 3 damage.',
      targetType: 'single_enemy',
      effect: { damage: 3 },
    },
    passive: {
      id: 'dragonfly-passive',
      name: 'Swift Wings',
      description: 'At the start of each turn, gain 1 mana.',
      trigger: 'on_turn_start',
      effect: { addMana: 1 },
    },
  },
  snail: {
    speciesId: 'snail',
    name: 'Snail',
    description: 'An immovable wall that protects allies and endures punishment.',
    maxHp: 22,
    initiative: 1,
    spriteId: 'snail',
    cards: ['snail-slam', 'snail-shell', 'snail-slide', 'guard'],
    defaultAction: {
      id: 'snail-auto-shell',
      name: 'Shell Up',
      description: 'Snail retreats into its shell, gaining 5 block.',
      targetType: 'self',
      effect: { addBlock: 5 },
    },
    passive: {
      id: 'snail-passive',
      name: 'Last Stand',
      description: 'When an ally dies, heal 5 HP.',
      trigger: 'on_ally_death',
      effect: { heal: 5 },
    },
  },
  scarab: {
    speciesId: 'scarab',
    name: 'Scarab',
    description: 'A mystic beetle that summons spirit wisps and stone barriers.',
    maxHp: 12,
    initiative: 4,
    spriteId: 'scarab',
    cards: ['scarab-summon-wisp', 'scarab-summon-wall', 'scarab-scratch', 'scarab-shell'],
    defaultAction: {
      id: 'scarab-auto-summon',
      name: 'Conjure Wisp',
      description: 'Scarab summons a Spirit Wisp.',
      targetType: 'self',
      effect: { summon: 'spirit_wisp' },
    },
    passive: null,
  },

  // ── Unlockable ──

  phoenix: {
    speciesId: 'phoenix',
    name: 'Phoenix',
    description: 'A blazing bird reborn from ash. Burns enemies and revives fallen allies.',
    maxHp: 13,
    initiative: 8,
    spriteId: 'phoenix',
    cards: ['phoenix-immolate', 'phoenix-rebirth', 'phoenix-ember', 'phoenix-ash-veil'],
    defaultAction: {
      id: 'phoenix-auto-burn',
      name: 'Cinder',
      description: 'Phoenix scorches an enemy for 3 damage.',
      targetType: 'single_enemy',
      effect: { damage: 3 },
    },
    passive: {
      id: 'phoenix-passive',
      name: 'Dying Flame',
      description: 'When an ally dies, deal 2 damage to all enemies.',
      trigger: 'on_ally_death',
      effect: { damage: 2 },
    },
  },
  scorpion: {
    speciesId: 'scorpion',
    name: 'Ironclad Scorpion',
    description: 'An armored predator with a venomous stinger. Tough to kill and hits hard.',
    maxHp: 18,
    initiative: 5,
    spriteId: 'scorpion',
    cards: ['scorpion-sting', 'scorpion-pincer', 'scorpion-carapace', 'scorpion-burrow'],
    defaultAction: {
      id: 'scorpion-auto-sting',
      name: 'Tail Jab',
      description: 'Scorpion jabs with its tail for 3 damage.',
      targetType: 'single_enemy',
      effect: { damage: 3 },
    },
    passive: {
      id: 'scorpion-passive',
      name: 'Venomous',
      description: 'When dealing damage, apply 1 poison for 2 turns.',
      trigger: 'on_deal_damage',
      effect: { applyDebuff: { type: 'poison', value: 1, duration: 2 } },
    },
  },
  centipede: {
    speciesId: 'centipede',
    name: 'Centipede',
    description: 'A skittering horror that overwhelms foes with relentless multi-strikes.',
    maxHp: 9,
    initiative: 9,
    spriteId: 'centipede',
    cards: ['centipede-flurry', 'centipede-bite', 'centipede-coil', 'centipede-flurry'],
    defaultAction: {
      id: 'centipede-auto-nip',
      name: 'Nip',
      description: 'Centipede nips a random enemy for 2 damage.',
      targetType: 'random_enemy',
      effect: { damage: 2 },
    },
    passive: {
      id: 'centipede-passive',
      name: 'Swarming Legs',
      description: 'At the start of each turn, draw 1 card.',
      trigger: 'on_turn_start',
      effect: { drawCards: 1 },
    },
  },
  goldWeevil: {
    speciesId: 'goldWeevil',
    name: 'Gold Weevil',
    description: 'A gilded beetle that converts riches into resilience. Wealth is armor.',
    maxHp: 16,
    initiative: 3,
    spriteId: 'gold-weevil',
    cards: ['weevil-gilt-slam', 'weevil-gold-shell', 'weevil-mint', 'guard'],
    defaultAction: {
      id: 'weevil-auto-block',
      name: 'Gild',
      description: 'Gold Weevil coats itself in gold, gaining 4 block.',
      targetType: 'self',
      effect: { addBlock: 4 },
    },
    passive: {
      id: 'weevil-passive',
      name: 'Gilded Carapace',
      description: 'At the end of each turn, gain 2 block.',
      trigger: 'on_turn_end',
      effect: { addBlock: 2 },
    },
  },
  wraithMoth: {
    speciesId: 'wraithMoth',
    name: 'Wraith Moth',
    description: 'A spectral moth drawn to defeat. Feeds on death to empower itself.',
    maxHp: 8,
    initiative: 7,
    spriteId: 'wraith-moth',
    cards: ['wraith-drain', 'wraith-haunt', 'wraith-shroud', 'mana-crystal'],
    defaultAction: {
      id: 'wraith-auto-siphon',
      name: 'Siphon',
      description: 'Wraith Moth drains an enemy for 2 damage and heals 1 HP.',
      targetType: 'single_enemy',
      effect: { damage: 2, heal: 1 },
    },
    passive: {
      id: 'wraith-passive',
      name: 'Death Harvest',
      description: 'When an enemy dies, gain 1 mana.',
      trigger: 'on_enemy_death',
      effect: { addMana: 1 },
    },
  },
};

export const allSpecies: CreatureSpecies[] = Object.values(creatureSpecies);

export function instantiateCreature(speciesId: string, formationPosition: { col: number; row: number }): PlayerCreature {
  const species = creatureSpecies[speciesId];
  if (!species) {
    throw new Error(`Unknown species: ${speciesId}`);
  }
  creatureCounter++;
  const uniqueId = `player-${speciesId}-${creatureCounter}-${Date.now()}`;
  return {
    id: uniqueId,
    speciesId: species.speciesId,
    name: species.name,
    side: 'player',
    maxHp: species.maxHp,
    currentHp: species.maxHp,
    block: 0,
    initiative: species.initiative,
    passive: species.passive,
    buffs: [],
    debuffs: [],
    isAlive: true,
    spriteId: species.spriteId,
    cards: [...species.cards],
    defaultAction: { ...species.defaultAction },
    currentAction: { ...species.defaultAction },
    level: 1,
    experience: 0,
    experienceToNextLevel: 10,
    formationPosition,
    equippedSlots: [],
  };
}
